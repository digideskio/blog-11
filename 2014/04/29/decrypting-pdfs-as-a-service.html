<!DOCTYPE html>
<html lang='en' manifest='/offline.appcache'>
<head>
<meta charset='utf-8'>
<title>
Sascha Faun Winter
</title>
<meta content='width=device-width, initial-scale=1.0' name='viewport'>
<meta content='Personal portfolio and blog of Sascha Faun Winter' name='description'>
<meta content='Sascha Faun Winter' name='author'>
<link href="/stylesheets/application.css" media="screen" rel="stylesheet" type="text/css" />
<!-- /[if lt IE 9] -->
<script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
<link href="/assets/ico/favicon.ico" rel="icon" type="image/ico" />
<link href='/assets/ico/apple-touch-icon-144x144-precomposed.png' rel='apple-touch-icon-precomposed' sizes='144x144'>
<link href='/assets/ico/apple-touch-icon-114x114-precomposed.png' rel='apple-touch-icon-precomposed' sizes='114x114'>
<link href='/assets/ico/apple-touch-icon-72x72-precomposed.png' rel='apple-touch-icon-precomposed' sizes='72x72'>
<link href='/assets/ico/apple-touch-icon-precomposed.png' rel='apple-touch-icon-precomposed'>
<link href='https://plus.google.com/u/0/112681783906373636049' rel='author'>
</head>
<body>
<header class='navbar navbar-fixed-top navbar-inverse'>
<div class='navbar-header'>
<button class='navbar-toggle' data-target='.navbar-collapse' data-toggle='collapse' type='button'>
<span class='sr-only'>Toggle navigation</span>
<span class='icon-bar'></span>
<span class='icon-bar'></span>
<span class='icon-bar'></span>
</button>
</div>
<div class='container'>
<div class='navbar-inner'>
<nav class='collapse navbar-collapse'>
<ul class='nav navbar-nav'>
<li>
<a href="/">Home</a>
</li>
<li>
<a href="/resume.html">Resume</a>
</li>
<li>
<a href="/contact.html">Contact</a>
</li>
</ul>
</nav>
</div>
</div>
</header>

<div class='container'>
<div class='row'>
<div class='col-lg-8 col-md-8 col-sm-12'>
<h1 class='page-title'>
Decrypting PDFs as a Service
</h1>
<aside class='attribion'>
by
<a rel="me" href="https://twitter.com/faunzy">Sascha Faun Winter</a>
</aside>
<div class='section'>
<div class='article'>
<p>Sometimes, you just need to decrypt encrypted PDFs. A lot of them.</p>

<p>Here&rsquo;s a <a href="https://gist.github.com/faun/11390337">shell script</a> to decrypt all encrypted PDFs in a folder. It uses the <code>security</code> command line tool for Mac OS, which stores the password for future use in the keychain.</p>
<div class="highlight shell"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre><pre class="lineno">2</pre><pre class="lineno">3</pre><pre class="lineno">4</pre><pre class="lineno">5</pre><pre class="lineno">6</pre><pre class="lineno">7</pre><pre class="lineno">8</pre><pre class="lineno">9</pre><pre class="lineno">10</pre><pre class="lineno">11</pre><pre class="lineno">12</pre><pre class="lineno">13</pre><pre class="lineno">14</pre><pre class="lineno">15</pre><pre class="lineno">16</pre><pre class="lineno">17</pre><pre class="lineno">18</pre><pre class="lineno">19</pre><pre class="lineno">20</pre><pre class="lineno">21</pre><pre class="lineno">22</pre><pre class="lineno">23</pre><pre class="lineno">24</pre><pre class="lineno">25</pre><pre class="lineno">26</pre><pre class="lineno">27</pre><pre class="lineno">28</pre><pre class="lineno">29</pre><pre class="lineno">30</pre><pre class="lineno">31</pre><pre class="lineno">32</pre><pre class="lineno">33</pre><pre class="lineno">34</pre><pre class="lineno">35</pre><pre class="lineno">36</pre><pre class="lineno">37</pre><pre class="lineno">38</pre><pre class="lineno">39</pre><pre class="lineno">40</pre></td><td class="code"><pre><span class="c">#! /bin/sh</span>

<span class="c"># Check if qpdf is installed</span>
<span class="nv">installed</span><span class="o">=</span><span class="k">$(</span>which qpdf &amp;&gt; /dev/null<span class="k">)</span>
<span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> -eq 1 <span class="o">]</span>; <span class="k">then
    </span><span class="nb">echo</span> &gt;&amp;2 <span class="s2">"Please install qpdf first (brew install qpdf)"</span>
    <span class="nb">exit </span>1
<span class="k">fi</span>

<span class="c"># Fetch the password from the keychain</span>
<span class="nv">password_entered</span><span class="o">=</span><span class="nb">false
</span><span class="nv">password</span><span class="o">=</span><span class="k">$(</span>security 2&gt; /dev/null find-generic-password -a login -s decrypt_pdfs -D <span class="s2">"application password"</span> -w<span class="k">)</span>

<span class="c"># Prompt for password if not in keychain</span>
<span class="k">if</span> <span class="o">[</span> -z <span class="nv">$password</span> <span class="o">]</span>; <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"Enter the password to decrypt PDFs:"</span>
    <span class="nb">read</span> -s password
    <span class="nv">password_entered</span><span class="o">=</span><span class="nb">true
</span><span class="k">fi</span>

<span class="c"># Make a folder called 'decrypted' unless it exists</span>
mkdir -p decrypted

<span class="c"># Decrypt all .pdf files in the current directory</span>
<span class="k">for </span>file <span class="k">in</span> <span class="k">*</span>.pdf; <span class="k">do
    </span><span class="nb">set</span> -e
    <span class="nb">echo</span> <span class="s2">"Decrypting </span><span class="nv">$file</span><span class="s2">"</span>
    qpdf --decrypt --password<span class="o">=</span><span class="s2">"</span><span class="nv">$password</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$file</span><span class="s2">"</span> <span class="s2">"decrypted/</span><span class="nv">$file</span><span class="s2">"</span>
<span class="k">done</span>

<span class="c"># Save the password to the keychain</span>
<span class="k">if</span> <span class="o">[</span> <span class="nv">$password_entered</span> !<span class="o">=</span> <span class="nb">false</span> <span class="o">]</span>; <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"Save password in keychain?"</span>
    <span class="nb">read </span>yn
    <span class="k">case</span> <span class="nv">$yn</span> <span class="k">in</span>
        <span class="o">[</span>Yy]<span class="k">*</span> <span class="p">)</span> security add-generic-password -a login -l pdf_password -s decrypt_pdfs -T <span class="s2">""</span> -w <span class="nv">$password</span>; <span class="nb">break</span><span class="p">;;</span>
        <span class="o">[</span>Nn]<span class="k">*</span> <span class="p">)</span> <span class="nb">exit</span><span class="p">;;</span>
        <span class="k">*</span> <span class="p">)</span> <span class="nb">echo</span> <span class="s2">"Please answer yes or no."</span><span class="p">;;</span>
    <span class="k">esac</span>
<span class="k">fi</span>
</pre></td></tr></tbody></table>
</div>

<p>Below is a similar <a href="https://gist.github.com/faun/11394915">service</a> for Automator that decrypts PDFs from a selection of either files or folders or both.</p>
<div class="highlight shell"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre><pre class="lineno">2</pre><pre class="lineno">3</pre><pre class="lineno">4</pre><pre class="lineno">5</pre><pre class="lineno">6</pre><pre class="lineno">7</pre><pre class="lineno">8</pre><pre class="lineno">9</pre><pre class="lineno">10</pre><pre class="lineno">11</pre><pre class="lineno">12</pre><pre class="lineno">13</pre><pre class="lineno">14</pre><pre class="lineno">15</pre><pre class="lineno">16</pre><pre class="lineno">17</pre><pre class="lineno">18</pre><pre class="lineno">19</pre><pre class="lineno">20</pre><pre class="lineno">21</pre><pre class="lineno">22</pre><pre class="lineno">23</pre><pre class="lineno">24</pre><pre class="lineno">25</pre><pre class="lineno">26</pre><pre class="lineno">27</pre><pre class="lineno">28</pre></td><td class="code"><pre><span class="c">#! /bin/sh</span>

<span class="nv">password</span><span class="o">=</span><span class="k">$(</span>security 2&gt; /dev/null find-generic-password -a login -s decrypt_pdfs -D <span class="s2">"application password"</span> -w<span class="k">)</span>

<span class="nb">set</span> -e

decrypt_file <span class="o">()</span> <span class="o">{</span>
  <span class="nv">source_file</span><span class="o">=</span><span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span>
  <span class="nv">filename</span><span class="o">=</span><span class="s2">"</span><span class="k">$(</span>basename <span class="s2">"</span><span class="nv">$source_file</span><span class="s2">"</span><span class="k">)</span><span class="s2">"</span>
  <span class="nv">directory</span><span class="o">=</span><span class="s2">"</span><span class="k">$(</span>dirname <span class="s2">"</span><span class="nv">$source_file</span><span class="s2">"</span><span class="k">)</span><span class="s2">/decrypted"</span>
  <span class="nv">destination</span><span class="o">=</span><span class="s2">"</span><span class="nv">$directory</span><span class="s2">/</span><span class="nv">$filename</span><span class="s2">"</span>
  mkdir -p <span class="s2">"</span><span class="nv">$directory</span><span class="s2">"</span>

  qpdf --decrypt --password<span class="o">=</span><span class="s2">"</span><span class="nv">$password</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$source_file</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$destination</span><span class="s2">"</span>
<span class="o">}</span>

<span class="k">for </span>arg <span class="k">in</span> <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span>; <span class="k">do

  if</span> <span class="o">[[</span> -d <span class="nv">$arg</span> <span class="o">]]</span>; <span class="k">then
    for </span>file <span class="k">in</span> <span class="s2">"</span><span class="nv">$arg</span><span class="s2">"</span>/<span class="k">*</span>.pdf; <span class="k">do
      </span>decrypt_file <span class="s2">"</span><span class="nv">$file</span><span class="s2">"</span>
    <span class="k">done

  elif</span> <span class="o">[[</span> -f <span class="nv">$arg</span> <span class="o">]]</span>; <span class="k">then
    </span>decrypt_file <span class="s2">"</span><span class="nv">$arg</span><span class="s2">"</span>
  <span class="k">fi

done</span>
</pre></td></tr></tbody></table>
</div>

<p>Passwords are stored in the Mac OS keychain. It is required to save the password to the keychain using the command-line tool before using the service, since the service uses the stored keychain password to decrypt the PDF.</p>

</div>
</div>
<hr>
<div class='section'>
<div class='article'>
<a class='btn btn-default' href='/'>←Back</a>
</div>
</div>

</div>
<div class='col-lg-4 col-md-4 col-sm-12'>
<aside>
<nav class='posts'>
<h3 class='post_title'>All Posts:</h3>
<ul class='recent'>
<li>
<a href="/2014/04/29/decrypting-pdfs-as-a-service.html">Decrypting PDFs as a Service</a>
</li>
<li>
<a href="/2013/01/27/installing-rspec-factorygirl-and-capybara-with-rails-32.html">Installing RSpec, FactoryGirl and Capybara with Rails 3.2</a>
</li>
<li>
<a href="/2012/12/16/restoring-archived-files-from-amazon-glacier-using-ruby.html">Restoring Archived Files from Amazon Glacier</a>
</li>
</ul>
</nav>
<nav class='elsewhere'>
<h3>Elsewhere on the Web</h3>
<ul>
<li>
<a rel="me" href="http://photos.faun.me">Personal Photography</a>
</li>
<li>
<a rel="me" href="https://twitter.com/faunzy">Twitter</a>
</li>
<li>
<a rel="me" href="https://github.com/faun">GitHub</a>
</li>
<li>
<a rel="me" href="http://www.linkedin.com/in/saschawinter">LinkedIn</a>
</li>
<li>
<a rel="me" href="http://flickr.com/faunzy">Flickr</a>
</li>
<li>
<a rel="me" href="http://instagram.com/faunzy">Instagram</a>
</li>
<li>
<a rel="me" href="http://plus.google.com/112681783906373636049">Google+</a>
</li>
</ul>
</nav>
</aside>

</div>
</div>
</div>
<script src='//code.jquery.com/jquery.min.js' type='text/javascript'></script>
<script src="/javascripts/application.js" type="text/javascript"></script>
<script>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-11110028-1']);
  _gaq.push(['_trackPageview']);
  
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</body>
</html>

